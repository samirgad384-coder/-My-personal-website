<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø±Ø®Ø§Ù… - Ù…Ø­Ù…Ø¯ Ø³Ù…ÙŠØ± Ø¬Ø§Ø¯</title>
    <style>
        /* --- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø¨Ù„Øª ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ --- */
       @media (min-width: 768px) {
  #tab-division iframe { 
    min-height: 90vh; 
    height: auto; 
  }
}

        @media (max-width: 767px) {
    #tab-division iframe { 
        height: calc(100vh - 150px) !important; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒÙ„Ù‡ Ù†Ø§Ù‚Øµ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù‡ÙŠØ¯Ø± */
        overflow-y: auto; /* Ù„Ùˆ Ø§Ø­ØªØ§Ø¬ ØªÙ…Ø±ÙŠØ± */
    }
}

@keyframes bgShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

        /* --- Ø§Ù„Ø®Ø·ÙˆØ· --- */
        @font-face { font-family: 'Cairo'; src: url('fonts/Cairo-Regular.ttf') format('truetype'); font-weight: 400; font-style: normal; }
        @font-face { font-family: 'Cairo'; src: url('fonts/Cairo-Bold.ttf') format('truetype'); font-weight: 700; font-style: normal; }
        @font-face { font-family: 'Cairo'; src: url('fonts/Cairo-Black.ttf') format('truetype'); font-weight: 900; font-style: normal; }

        /* --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª --- */
        * { margin:0; padding:0; box-sizing:border-box; }
       body {
  font-family:'Cairo',sans-serif;
  background: linear-gradient(135deg, #8B0000 0%, #650000 50%, #8B0000 100%);
  background-size: 400% 400%;
  animation: bgShift 15s ease infinite;
  min-height:100vh;
  padding:0;
  display:block;
}


        /* --- Ø³ØªØ§ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ÙØ®Ø§Ù…Ø©) --- */
        #activationOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #8B0000 0%, #4a0000 100%);
            z-index: 9999; display: flex;
            flex-direction: column; /* ØªØ¹Ø¯ÙŠÙ„ Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙˆÙ‚ Ø¨Ø¹Ø¶ */
            justify-content: center; align-items: center; padding: 20px;
            gap: 20px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø¨ÙˆÙƒØ³ Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆÙƒØ§Ø±Øª Ø§Ù„ØªÙØ¹ÙŠÙ„ */
        }

        /* Ø³ØªØ§ÙŠÙ„ Ø¨ÙˆÙƒØ³ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .contact-box {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 450px;
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .contact-title {
            color: #8B0000;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        .contact-icons {
            display: flex;
            justify-content: center;
            gap: 25px;
        }
        .contact-icon-link {
            display: inline-block;
            transition: transform 0.2s;
        }
        .contact-icon-link:hover { transform: scale(1.15); }
        .c-icon { width: 40px; height: 40px; }

        .activation-card {
            background: rgba(255, 255, 255, 0.98);
            border: 4px solid #FFD700;
            border-radius: 25px;
            padding: 40px 30px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .welcome-icon { font-size: 60px; margin-bottom: 10px; }
        .welcome-title { color: #8B0000; font-size: 2em; font-weight: 900; margin-bottom: 10px; text-shadow: 1px 1px 0px rgba(0,0,0,0.1); }
        .welcome-subtitle { color: #555; font-size: 1.1em; margin-bottom: 30px; font-weight: 600; }

        .auth-input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            border: 2px solid #8B0000; border-radius: 12px;
            font-size: 1.1em; font-family: 'Cairo', sans-serif; font-weight: 700;
            background: #FFF9E6; color: #333; transition: all 0.3s;
            text-align: center;
        }
        .auth-input:focus { border-color: #FFD700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); outline: none; }

        .auth-btn {
            width: 100%; padding: 16px;
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
            color: #FFD700; font-size: 1.3em; font-weight: 900;
            border: none; border-radius: 12px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
            transition: transform 0.2s;
        }
        .auth-btn:hover { transform: scale(1.02); }
        .error-msg { color: #DC143C; font-weight: bold; margin-top: 10px; min-height: 25px; }

        /* --- Ø¨Ø§Ù‚ÙŠ Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) --- */
      .container{
  max-width:100%;
  width:100%;
  margin:0;
  padding:20px;
}

.division-frame{
  width:100%;
  height:100%;
  min-height:85vh;
  border:none;
  border-radius:15px;
}

        .header-section{text-align:center;margin-bottom:20px}
        .logo-img{width:150px;height:auto;margin-bottom:10px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,.5)}
        .dev-name{font-size:1.3em;color:#FFD700;font-weight:700;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.4)}
        .tabs-container{display:flex;justify-content:center;gap:15px;margin:15px 0;}
        .tab-btn{padding:12px 25px;font-size:1.1em;font-family:'Cairo',sans-serif;font-weight:700;background:rgba(255,215,0,.3);color:#8B0000;border:2px solid #8B0000;border-radius:10px;cursor:pointer;transition:all .3s ease;}
        .tab-btn.active{background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,215,0,.5);}
        .tab-btn:hover{transform:translateY(-1px);}
        .tab-panel{display:none;}
          .tab-panel.active{
  display:block;
  width:100%;
  min-height:100vh;
  position:relative;
}

        .custom-alert-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0);display:none;justify-content:center;align-items:center;z-index:10000;opacity:0;transition:all .8s ease}
        .custom-alert-overlay.show{display:flex;background:rgba(0,0,0,.7);opacity:1}
        .custom-alert-box{background:#fff;border-radius:20px;padding:40px 30px;max-width:400px;width:90%;text-align:center;box-shadow:0 10px 50px rgba(0,0,0,.5);opacity:0;transform:scale(.5);transition:all .8s ease}
        .custom-alert-overlay.show .custom-alert-box{opacity:1;transform:scale(1)}
        .alert-icon{width:80px;height:80px;border-radius:50%;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;font-size:50px;color:#fff;font-weight:700}
        .alert-icon.success{background:linear-gradient(135deg,#10b981 0%,#059669 100%);box-shadow:0 5px 20px rgba(16,185,129,.4)}
        .alert-icon.error{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);box-shadow:0 5px 20px rgba(239,68,68,.4)}
        .alert-icon.warning{background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);box-shadow:0 5px 20px rgba(245,158,11,.4)}
        .alert-title{font-family:'Cairo',sans-serif;font-size:1.5em;font-weight:700;color:#1f2937;margin-bottom:15px}.alert-message{font-family:'Cairo',sans-serif;font-size:1.1em;color:#6b7280;margin-bottom:25px;line-height:1.6}
        .alert-buttons{display:flex;gap:10px;justify-content:center}
        .alert-ok-btn{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;border:none;padding:15px 40px;border-radius:12px;font-family:'Cairo',sans-serif;font-size:1.1em;font-weight:700;cursor:pointer;box-shadow:0 5px 15px rgba(16,185,129,.3);transition:all .3s ease}
        .alert-ok-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(16,185,129,.4)}
        .alert-cancel-btn{background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);color:#fff;border:none;padding:15px 40px;border-radius:12px;font-family:'Cairo',sans-serif;font-size:1.1em;font-weight:700;cursor:pointer;box-shadow:0 5px 15px rgba(107,114,128,.3);transition:all .3s ease}
        .alert-cancel-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(107,114,128,.4)}
        .burger-menu{position:fixed;top:15px;left:15px;z-index:1000}
        .burger-icon{width:32px;height:32px;background:#FFD700;border-radius:6px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:4px;padding:6px;box-shadow:0 4px 15px rgba(0,0,0,.3);transition:all .3s ease}
        .burger-icon:hover{background:#FFA500}
        .burger-line{width:20px;height:2.5px;background:#8B0000;border-radius:2px}
        .notes-panel{position:fixed;top:0;left:-100%;width:90%;max-width:380px;height:100vh;background:rgba(255,255,255,.98);box-shadow:4px 0 20px rgba(0,0,0,.5);transition:left .3s ease;z-index:999;display:flex;flex-direction:column}
        .notes-panel.open{left:0}
        .notes-header{display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:3px solid #8B0000;flex-shrink:0;min-height:70px}
        .notes-title{font-size:1.5em;color:#8B0000;font-weight:700}
        .close-notes{font-size:1.8em;color:#8B0000;cursor:pointer;background:0 0;border:none;padding:0 10px;line-height:1}
        .search-box{padding:10px 15px;border-bottom:2px solid #8B0000;flex-shrink:0}
        .search-input{width:100%;padding:12px;font-family:'Cairo',sans-serif;font-size:1em;border:2px solid #8B0000;border-radius:8px;background:#fff;text-align:center;font-weight:600}
        .search-input:focus{outline:0;border-color:#DC143C;box-shadow:0 0 0 3px rgba(220,20,60,.2)}
        .search-input::placeholder{color:#9ca3af;font-weight:500}
        .notes-actions{display:none;justify-content:center;gap:10px;padding:10px 15px;background:rgba(139,0,0,.1);border-bottom:2px solid #8B0000;flex-shrink:0}
        .notes-actions.show{display:flex}
        .action-btn{flex:1;padding:12px;font-size:1em;font-family:'Cairo',sans-serif;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:all .3s ease;color:#fff}
        .delete-selected-btn{background:linear-gradient(135deg,#DC143C 0%,#8B0000 100%);box-shadow:0 3px 10px rgba(220,20,60,.3)}
        .delete-selected-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(220,20,60,.5)}
        .copy-selected-btn{background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);box-shadow:0 3px 10px rgba(59,130,246,.3)}
        .copy-selected-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(59,130,246,.5)}
        .saved-notes-list{flex:1;overflow-y:auto;overflow-x:hidden;padding:15px;-webkit-overflow-scrolling:touch;min-height:0}.saved-notes-list::-webkit-scrollbar{width:10px}.saved-notes-list::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}.saved-notes-list::-webkit-scrollbar-thumb{background:#8B0000;border-radius:10px}
        .saved-notes-list::-webkit-scrollbar-thumb:hover{background:#DC143C}
        .saved-note-item{background:#f9fafb;border:2px solid #8B0000;border-radius:10px;padding:15px;margin-bottom:15px;position:relative;overflow-x:auto;cursor:pointer;transition:all .3s ease;user-select: none;}
        .saved-note-item:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.2)}
        .saved-note-item.selected{background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);border-color:#DC143C;border-width:3px}
        .note-item-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:10px}
        .note-item-name{font-weight:700;color:#8B0000;font-size:1.1em}
        .note-item-date{font-size:.75em;color:#6b7280;margin-top:3px}
        .note-buttons{display:flex;gap:5px}
        .copy-note-btn{background:#3b82f6;color:#fff;border:none;border-radius:5px;padding:5px 10px;cursor:pointer;font-size:.9em;font-weight:600}
        .copy-note-btn:hover{background:#2563eb}
        .delete-note-btn{background:#DC143C;color:#fff;border:none;border-radius:5px;padding:5px 10px;cursor:pointer;font-size:.9em;font-weight:600}
        .delete-note-btn:hover{background:#8B0000}
        .note-item-details{font-size:.9em;color:#374151;line-height:1.6;overflow-x:auto}
        .operations-table{width:100%;border-collapse:collapse;margin:10px 0;background:#fff;border-radius:8px;overflow:visible;font-size:.95em;position:relative}
        .operations-table th{background:linear-gradient(135deg,#8B0000 0%,#DC143C 100%);color:#FFD700;padding:10px 6px;font-weight:700;text-align:center;border:1px solid #6B0000;font-size:1em}
        .operations-table td{padding:8px 6px;text-align:center;border:1px solid #ddd;color:#1f2937;font-size:1em;font-weight:600}
        .operations-table tr:nth-child(even){background:#f9fafb}
        .operations-table tr:hover{background:#FFF9E6}
        .operations-table td.price-cell{cursor:pointer;position:relative;transition:all .4s ease}
        .operations-table td.price-cell:hover{background:#FFE680;transform:scale(1.01)}
        .price-tooltip{position:fixed;background:linear-gradient(135deg,#1e3a8a 0%,#1e40af 100%);color:#FFD700;padding:10px 16px;border-radius:10px;font-size:1em;font-weight:700;white-space:nowrap;z-index:10001;box-shadow:0 6px 20px rgba(30,58,138,.7);pointer-events:none;opacity:0;transition:opacity .3s ease;border:2px solid #FFD700}
        .price-tooltip.show{opacity:1}.price-tooltip::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #1e3a8a}
        .note-item-total{font-weight:700;color:#059669;font-size:1.2em;margin-top:8px}
        .note-price-per-meter{font-weight:700;font-size:1.05em;color:#1e3a8a;margin-top:8px;padding:8px;background:linear-gradient(135deg,#dbeafe 0%,#bfdbfe 100%);border-radius:8px;border:2px solid #1e3a8a;text-align:center}
        .empty-notes{text-align:center;color:#6b7280;padding:40px 20px;font-size:1.1em}
        h1{text-align:center;color:#FFD700;font-size:2.5em;margin-bottom:20px;text-shadow:3px 3px 6px rgba(0,0,0,.4);font-weight:700}
        .card{background:rgba(255,255,255,.95);border-radius:20px;padding:30px;box-shadow:0 15px 50px rgba(0,0,0,.5)}
        .input-row{display:flex;gap:15px;margin-bottom:20px}
        .input-group-right{flex:1;display:flex;flex-direction:column}
        .input-group-left{flex:1;display:flex;gap:10px}
        .input-wrapper{flex:1;display:flex;flex-direction:column}
        .count-select{width:120px;display:flex;flex-direction:column}
        .label{font-size:1.1em;color:#1f2937;margin-bottom:8px;font-weight:600}
        .input-field{width:100%;padding:15px;font-size:18px;font-family:'Cairo',sans-serif;border:3px solid #8B0000;border-radius:12px;background:#FFD700;color:#1f2937;font-weight:600;text-align:center}
        .input-field:focus{outline:0;border-color:#DC143C;box-shadow:0 0 0 4px rgba(220,20,60,.2)}.input-field::placeholder{color:#6b7280;opacity:.7}
        select.input-field{cursor:pointer;appearance:none;background-image:url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231f2937' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:left 15px center;padding-left:40px}.custom-input{display:none;margin-top:10px}
        .btn-calculate{width:100%;padding:18px;font-size:1.3em;font-family:'Cairo',sans-serif;font-weight:700;background:linear-gradient(135deg,#DC143C 0%,#8B0000 100%);color:#fff;border:none;border-radius:12px;cursor:pointer;margin-bottom:20px;box-shadow:0 5px 20px rgba(220,20,60,.4);transition:all .3s ease}.btn-calculate:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(220,20,60,.6)}
        .btn-calculate:active{transform:translateY(0)}
        .result-box{background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);padding:35px;border-radius:15px;text-align:center;border:4px solid #8B0000;box-shadow:0 8px 30px rgba(0,0,0,.4);margin-bottom:20px;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{box-shadow:0 8px 30px rgba(0,0,0,.4)}50%{box-shadow:0 8px 40px rgba(255,215,0,.6)}}
        .result-label{font-size:1.4em;color:#8B0000;margin-bottom:12px;font-weight:700}
        .result-value{font-size:3.5em;font-weight:700;color:#8B0000;text-shadow:3px 3px 6px rgba(255,255,255,.4);line-height:1}
        .unit{font-size:.5em;font-weight:600}
        .price-box{background:rgba(255,215,0,.3);border:3px solid #8B0000;border-radius:12px;padding:20px;margin-bottom:20px}
        .price-box .label{text-align:center;margin-bottom:10px;font-size:1.1em}
        .total-price-box{background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:30px;border-radius:12px;text-align:center;border:3px solid #065f46;box-shadow:0 5px 20px rgba(16,185,129,.4);margin-bottom:20px;position: relative;}
        .total-price-label{font-size:1.2em;color:#fff;margin-bottom:10px;font-weight:700}
        .total-price-value{font-size:2.8em;font-weight:700;color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
        .scroll-to-top-btn{position: absolute;top: 10px;left: 10px;background: #FFD700;color: #8B0000;border: none;width: 40px;height: 40px;border-radius: 50%;font-weight: bold;font-size: 1.2em;cursor: pointer;box-shadow: 0 3px 8px rgba(0,0,0,0.3);z-index: 10;transition: transform 0.2s;}.scroll-to-top-btn:hover{transform: scale(1.1);}
        .note-name-box{background:rgba(139,0,0,.1);border:3px solid #8B0000;border-radius:12px;padding:20px;margin-bottom:15px}
        .note-name-input{width:100%;padding:15px;font-family:'Cairo',sans-serif;font-size:1.1em;border:2px solid #8B0000;border-radius:8px;background:#fff;text-align:center;font-weight:600}
        .note-name-input::placeholder{color:#9ca3af;font-weight:500}
        .save-btn,.reset-btn{width:100%;padding:12px;font-size:1em;font-family:'Cairo',sans-serif;font-weight:600;color:#fff;border:none;border-radius:12px;cursor:pointer;margin-top:15px;transition:all .3s ease}
        .save-btn{background:linear-gradient(135deg,#10b981 0%,#059669 100%);box-shadow:0 5px 20px rgba(16,185,129,.4)}
        .save-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(16,185,129,.6)}
        .reset-btn{background:#6b7280}
        .reset-btn:hover{background:#4b5563}

        @media (max-width:768px){
            h1{font-size:1.8em}body{padding:10px}
            .card{padding:20px}
            .input-row{flex-direction:column}.input-group-left{flex-direction:column}
            .count-select{width:100%}
            .result-value{font-size:2.5em}
            .notes-panel{width:90%}.logo-img{width:100px}
            .dev-name{font-size:1em}
            .container{padding:0 5px}
            .operations-table{font-size:.85em}
            .operations-table th{padding:8px 5px;font-size:.9em}
            .operations-table td{padding:8px 5px;font-size:.9em}
            .saved-note-item{padding:10px}
            .note-item-name{font-size:1em}
            .custom-alert-box{padding:30px 20px}
            .alert-icon{width:70px;height:70px;font-size:40px}
            .alert-title{font-size:1.3em}.alert-message{font-size:1em}
            .price-tooltip{font-size:0.9em;padding:8px 12px}
            .note-price-per-meter{font-size:0.95em;padding:6px}
            .tabs-container{flex-direction:row;gap:10px}
            .tab-btn{padding:12px 20px;font-size:1em}
        }
    </style>
</head>
<body>

<!-- Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù‡Ùˆ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ­ÙŠØ¯: Ø´Ø§Ø´Ø© ØªÙØ¹ÙŠÙ„ ÙØ®Ù…Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙØ±Ø§Øº -->
<div id="activationOverlay" style="display:none;">
    <div class="contact-box">
        <div class="contact-title">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„ØªÙØ¹ÙŠÙ„</div>
        <div class="contact-icons">
            <a href="https://wa.me/+201118435630" target="_blank" class="contact-icon-link">
                <!-- SVG WhatsApp -->
                <svg class="c-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="#25D366" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
            </a>
            <a href="https://t.me/MSG_11g" target="_blank" class="contact-icon-link">
                <!-- SVG Telegram -->
                <svg class="c-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="#0088cc" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg>
            </a>
            <a href="#" onclick="event.preventDefault()" class="contact-icon-link">
                <!-- SVG Facebook -->
                <svg class="c-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path fill="#1877F2" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
            </a>
        </div>
    </div>
    <div class="activation-card" id="activationContent">
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨ÙŠØªÙ… Ø­Ù‚Ù†Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    </div>
</div>

<div id="appContent" style="display:none;">
    <div class="custom-alert-overlay" id="customAlert">
        <div class="custom-alert-box">
            <div class="alert-icon" id="alertIcon">âœ“</div>
            <div class="alert-title" id="alertTitle">ØªÙ†Ø¨ÙŠÙ‡</div>
            <div class="alert-message" id="alertMessage">Ø±Ø³Ø§Ù„Ø©</div>
            <div class="alert-buttons" id="alertButtons"><button class="alert-ok-btn" onclick="closeCustomAlert()">Ø­Ø³Ù†Ø§Ù‹</button>
            </div>
        </div>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¨Ø±Ø¬Ø± (Ø¨ÙŠØ¸Ù‡Ø± Ø¨Ø³ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©) -->
    <div class="burger-menu" id="burgerMenu">
        <div class="burger-icon" onclick="toggleNotes()">
            <div class="burger-line"></div>
            <div class="burger-line"></div>
            <div class="burger-line"></div>
        </div>
    </div>

    <div class="notes-panel" id="notesPanel">
        <div class="notes-header">
            <div class="notes-title">ğŸ“‹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</div>
            <button class="close-notes" onclick="toggleNotes()">Ã—</button>
        </div>
        <div class="search-box"><input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª..." oninput="searchNotes()">
        </div>
        <div class="notes-actions" id="notesActions">
            <button class="action-btn delete-selected-btn" onclick="deleteSelected()">ğŸ—‘ï¸ Ù…Ø³Ø­</button><button class="action-btn copy-selected-btn" onclick="copySelected()">ğŸ“‹ Ù†Ø³Ø®</button></div>
        <div class="saved-notes-list" id="savedNotesList">
            <div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>
        </div>
    </div>
    <div class="container">
        <div class="header-section">
            <img src="https://i.postimg.cc/T3dQhpcs/Screenshot-2025-12-25-16-21-38-19-99c04817c0de5652397fc8b56c3b3817.jpg" alt="Logo" class="logo-img">
            <div class="dev-name" id="userName">ğŸ‘·</div>
        </div>

        <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙÙ‚ÙŠ -->
        <div class="tabs-container">
            <button class="tab-btn active" id="tab1" onclick="switchTab('marble')">ğŸª¨ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø®Ø§Ù…</button>
            <button class="tab-btn" id="tab2" onclick="switchTab('division')">ğŸ”ª ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</button>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø®Ø§Ù… -->
        <div class="tab-panel active" id="tab-marble">
            <h1>ğŸª¨ Ø­Ø§Ø³Ø¨Ø© Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø±Ø®Ø§Ù…</h1>
            <div class="card">
                <!-- Ø¨Ø§Ù‚ÙŠ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ù‡Ù†Ø§ -->
                <div class="input-row">
                    <div class="input-group-right">
                        <label class="label">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
                        <input type="number" class="input-field" id="length" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)" step="0.01" min="0">
                    </div>
                    <div class="input-group-left">      <div class="input-wrapper">
                        <label class="label">Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)</label>
                        <input type="number" class="input-field" id="width" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)" step="0.01" min="0">
                    </div>
                        <div class="count-select">
                            <label class="label">Ø§Ù„Ø¹Ø¯Ø¯</label>
                            <select class="input-field" id="countSelect" onchange="handleCountSelect(this)">
                                <!-- Options from 1 to 50 + custom -->
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <!-- ... up to 50 -->
                                <option value="50">50</option>
                                <option value="custom">Ø¥Ø¯Ø®Ø§Ù„ Ø¢Ø®Ø±</option>
                            </select>
                            <input type="number" class="input-field custom-input" id="customCount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯" min="1" style="display:none;">
                        </div>
                    </div>
                </div>
                <div class="price-box">
                    <label class="label">ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…ØªØ± Ø§Ù„Ù…Ø±Ø¨Ø¹ (Ø¬Ù†ÙŠÙ‡)</label>
                    <input type="number" class="input-field" id="pricePerMeter" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±" step="0.01" min="0" oninput="savePrice();">
                </div>
                <button class="btn-calculate" onclick="calculate()">Ø§Ø­Ø³Ø¨</button>
                <div class="result-box">
                    <div class="result-label">ğŸ“ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</div>
                    <div class="result-value" id="totalArea">0.00 <span class="unit">Ù…Â²</span></div>
                </div>
                <div class="total-price-box" id="totalPriceBox" style="display:none;">
                    <div class="total-price-label">ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                    <div class="total-price-value" id="totalPrice">0.00 <span class="unit">Ø¬Ù†ÙŠÙ‡</span></div>
                    <!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
                    <button class="scroll-to-top-btn" onclick="scrollToInputs()">â†‘</button>
                </div>
                <div class="note-name-box">
                    <label class="label" style="text-align:center;margin-bottom:10px;">ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
                    <input type="text" class="note-name-input" id="noteName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø©">
                </div>
                <button class="save-btn" onclick="saveNote()">ğŸ’¾ Ø­ÙØ¸</button>
                <button class="reset-btn" onclick="resetAll()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„</button>
            </div>
        </div>
<div class="tab-panel" id="tab-division">
   <iframe src="division.html" class="division-frame"></iframe>

    </div>
</div>

<script>
    // === Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØª ===
    function playBeep() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = 800;
        osc.type = "sine";    gain.gain.setValueAtTime(0.3, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.1);
      } catch (e) {}
    }

    // === Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØª Ù„ÙƒÙ„ Ø¥Ù†Ø¨ÙˆØª ===
    function addInputSounds() {
      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        ['focus', 'input', 'change'].forEach(eventType => {
          input.addEventListener(eventType, playBeep);
        });
      });
    }

    // === Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ ===
    function switchTab(tab) {
      const tab1 = document.getElementById('tab1');
      const tab2 = document.getElementById('tab2');
      const panelMarble = document.getElementById('tab-marble');
      const panelDivision = document.getElementById('tab-division');
      const burgerMenu = document.getElementById('burgerMenu');

      if (tab === 'division') {
        tab1.classList.remove('active');
        tab2.classList.add('active');
        panelMarble.classList.remove('active');
        panelDivision.classList.add('active');

        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¨Ø±Ø¬Ø±
        if (burgerMenu) burgerMenu.style.display = 'none';
      } else {
        tab2.classList.remove('active');
        tab1.classList.add('active');
        panelDivision.classList.remove('active');
        panelMarble.classList.add('active');

        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¨Ø±Ø¬Ø±
        if (burgerMenu) burgerMenu.style.display = '';
      }
    }

    // === Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¥Ù†Ø¨ÙˆØªØ§Øª ===
    function scrollToInputs() {
      playBeep();
      document.getElementById("length").scrollIntoView({ behavior: "smooth", block: "start" });
      document.getElementById("length").focus();
    }
    // === Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ===
    var pieces = [];
    var currentOrientation = 'length';

    // === Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ===
    function toggleOrientation() {
      playBeep();
      currentOrientation = currentOrientation === 'length' ? 'width' : 'length';
      const btn = document.getElementById('orientationBtn');
      btn.textContent = currentOrientation === 'length' ? 'Ø·ÙˆÙ„ â¬Œ' : 'Ø¹Ø±Ø¶ â¬';
    }

    // === Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹Ø© ===
    function addPiece() {
      playBeep();
      const length = parseFloat(document.getElementById('pieceLength').value);
      const width = parseFloat(document.getElementById('pieceWidth').value);
      const quantity = parseInt(document.getElementById('pieceQuantity').value) || 1;
      const name = document.getElementById('pieceName').value || `Ù‚Ø·Ø¹Ø©-${pieces.length + 1}`;

      if (!length || !width) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶');
        return;
      }

      for (let i = 0; i < quantity; i++) {
        pieces.push({
          id: Date.now() + i,
          length: length * 10,
          width: width * 10,
          name: quantity > 1 ? `${name}-${i+1}` : name,
          orientation: currentOrientation
        });
      }

      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById('pieceLength').value = '';
      document.getElementById('pieceWidth').value = '';
      document.getElementById('pieceQuantity').value = '1';
      document.getElementById('pieceName').value = '';

      alert(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${quantity} Ù‚Ø·Ø¹Ø©!`);
    }

    // === Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===
    var CIPHER_KEY = "MSG-STATIC-KEY-2025";

    var allNotes = [];
    function encrypt(t) {
      const e = new TextEncoder().encode(t);
      let n = "";
      for (let t = 0; t < e.length; t++)
        n += String.fromCharCode(e[t] ^ CIPHER_KEY.charCodeAt(t % CIPHER_KEY.length));
      return btoa(n);
    }

    function decrypt(t) {
      try {
        const e = atob(t), n = new Uint8Array(e.length);
        for (let t = 0; t < e.length; t++)
          n[t] = e.charCodeAt(t) ^ CIPHER_KEY.charCodeAt(t % CIPHER_KEY.length);
        return (new TextDecoder).decode(n);
      } catch (t) {
        return null;
      }
    }

    function secureSet(t, e) {
      localStorage.setItem("_s_" + btoa(t), encrypt(e));
    }

    function secureGet(t) {
      const e = localStorage.getItem("_s_" + btoa(t));
      return e ? decrypt(e) : null;
    }

    function secureRemove(t) {
      localStorage.removeItem("_s_" + btoa(t));
    }

    function savePrice() {
      const t = document.getElementById("pricePerMeter").value;
      t && secureSet("lastPrice", t);
    }

    function loadPrice() {
      const t = secureGet("lastPrice");
      t && (document.getElementById("pricePerMeter").value = t);
    }

    function ensureBackupId() {
      if (!secureGet("backup_id")) {
        const bid = "BKP-" + Date.now() + "-" + Math.random().toString(36).substr(2, 8);
        secureSet("backup_id", bid);
      }
    }

    async function sendActivationToServer(deviceId, activationCode) {  try {
        await fetch("https://damp-glade-37c5.gads7514.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            deviceId: deviceId,
            code: activationCode,
            userName: secureGet("user_name"),
            phone: secureGet("user_phone")
          })
        });
      } catch (err) {
        // silent fail
      }
    }

    var APP_DEVICE_ID = "", APP_SALT = "Z#4@", MAX_ATTEMPTS = 3;

    function h(t) {
      return crypto.subtle.digest("SHA-256", (new TextEncoder).encode(t)).then(t => Array.from(new Uint8Array(t)).map(t => t.toString(16).padStart(2, "0")).join(""));
    }

    function k() {
      return String.fromCharCode(81) + "9" + "!@".charAt(0) + ["m", "L", "X"].join("") + "15";
    }

    async function start() {
      ensureBackupId();
      const activationOverlay = document.getElementById("activationOverlay");
      const activationContent = document.getElementById("activationContent");
      const appContent = document.getElementById("appContent");

      const t = secureGet("activated"), e = secureGet("device_id");

      // 1. Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
      if ("true" === t) {
        if (e !== APP_DEVICE_ID) {
            // Ø¬Ù‡Ø§Ø² Ù…Ø®ØªÙ„Ù
            activationContent.innerHTML = '<div class="welcome-icon">ğŸš«</div><h2 class="welcome-title">ØªÙ… Ø§Ù„Ø±ÙØ¶</h2><p class="error-msg" style="font-size:1.5em">Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡</p>';
            activationOverlay.style.display = "flex";
            appContent.style.display = "none";
            return;
        }

        // ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø³Ø§Ø¨Ù‚Ø§Ù‹ - Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const savedName = secureGet("user_name");
        if (savedName) {
          document.getElementById("userName").textContent = "ğŸ‘· " + savedName;
        }
        activationOverlay.style.display = "none";
        appContent.style.display = "block";
        return;
      }

      // 2. Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø£Ùˆ ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù„)
      const savedName = secureGet("user_name");
      const savedPhone = secureGet("user_phone");

      activationOverlay.style.display = "flex";
      appContent.style.display = "none";

      if (!savedName || !savedPhone) {
        // --- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø´ÙŠÙƒ) ---
        activationContent.innerHTML = `
          <div class="welcome-icon">ğŸ‘‹</div>
          <h2 class="welcome-title">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø©</h2>
          <p class="welcome-subtitle">Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ø´Ø§Ù† Ù†Ø¨Ø¯Ø£ Ø´ØºÙ„</p>

          <input id="userNameInput" class="auth-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
          <input id="userPhone" class="auth-input" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">

          <p id="infoMsg" class="error-msg"></p>
          <button class="auth-btn" onclick="saveUserInfo()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        `;
      } else {
        // --- Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ø§Ù„ÙƒÙˆØ¯) ---
        showActivationScreen();
      }
    }

    function saveUserInfo() {
      const userName = document.getElementById("userNameInput").value.trim();
      const userPhone = document.getElementById("userPhone").value.trim();
      const infoMsg = document.getElementById("infoMsg");

      if (!userName || userName.split(' ').length < 3) {
        infoMsg.textContent = "ÙŠØ§ Ø±ÙŠØª ØªÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ ÙƒØ§Ù…Ù„";
        return;
      }
      if (!userPhone || userPhone.length < 11) {
        infoMsg.textContent = "Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…Ø´ Ù…Ø¸Ø¨ÙˆØ·";
        return;
      }

      secureSet("user_name", userName);
      secureSet("user_phone", userPhone);

      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
      showActivationScreen();
    }

    function showActivationScreen() {
        const activationContent = document.getElementById("activationContent");
        activationContent.innerHTML = `
            <div class="welcome-icon">ğŸ”</div>
            <h2 class="welcome-title">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
            <p class="welcome-subtitle">Ø§Ø¨Ø¹Øª Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡ Ù„Ù„Ù…Ø·ÙˆØ± Ø¹Ø´Ø§Ù† ÙŠÙØ¹Ù„Ùƒ Ø§Ù„Ù†Ø³Ø®Ø©</p>

            <div style="background:#FFF9E6; border:2px dashed #8B0000; border-radius:10px; padding:15px; margin-bottom:20px;">
                <b id="deviceCodeDisplay" style="font-size:1.4em; color:#DC143C; display:block; word-break:break-all;">${APP_DEVICE_ID}</b>
            </div>

            <button onclick="copyDeviceCode()" style="margin-bottom:20px; background:#3b82f6; border:none; color:#fff; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:700; width:100%;">
              Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
            </button>

            <input id="c" class="auth-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù‡Ù†Ø§">
            <button onclick="chk()" class="auth-btn">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
            <p id="m" class="error-msg"></p>
        `;
    }

    function copyDeviceCode() {
      playBeep();
      const deviceCode = APP_DEVICE_ID;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(deviceCode).then(() => {
          showCustomAlert("âœ… ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø²!", "success");
        }).catch(() => { fallbackCopyDeviceCode(deviceCode); });
      } else {
        fallbackCopyDeviceCode(deviceCode);
      }
    }

    function fallbackCopyDeviceCode(text) {
      const tempInput = document.createElement("input");
      tempInput.value = text;
      tempInput.style.position = "fixed";
      tempInput.style.top = "0";
      tempInput.style.left = "-9999px";
      document.body.appendChild(tempInput);
      tempInput.select();
      tempInput.setSelectionRange(0, 99999);

      try {
        document.execCommand("copy");
        showCustomAlert("âœ… ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø²!", "success");
      } catch (err) {
        showCustomAlert("âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® - Ø­Ø§ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹", "error");
      }

      document.body.removeChild(tempInput);
    }

    async function chk() {
      let t = parseInt(secureGet("attempts") || "0");
      if (t >= MAX_ATTEMPTS) {
        document.getElementById("activationContent").innerHTML = '<div class="welcome-icon">ğŸ”’</div><h2 class="welcome-title">ØªÙ… Ø§Ù„Ù‚ÙÙ„</h2><p class="error-msg" style="font-size:1.5em; color:#DC143C">ØªØ¬Ø§ÙˆØ²Øª Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§</p>';
        return;
      }

      let e = document.getElementById("c").value.trim();
      if (e === await h(APP_DEVICE_ID + k() + APP_SALT)) {
        const userName = secureGet("user_name");

        secureRemove("activated");
        secureSet("activated", "true");
        secureSet("device_id", APP_DEVICE_ID);
        secureSet("attempts", "0");

        await sendActivationToServer(APP_DEVICE_ID, e);

        document.getElementById("activationContent").innerHTML = '<div class="welcome-icon">âœ…</div><h2 class="welcome-title" style="color:#10b981">Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø©!</h2><p class="welcome-subtitle">ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­</p>';

        if (userName) {
          document.getElementById("userName").textContent = "ğŸ‘· " + userName;
        }

        setTimeout(() => {
          document.getElementById("activationOverlay").style.display = "none";
          document.getElementById("appContent").style.display = "block";
        }, 1500);
      } else {
        t++;
        secureSet("attempts", t.toString());
        const msg = document.getElementById("m");
        msg.innerText = "Ø§Ù„ÙƒÙˆØ¯ ØºÙ„Ø· â€“ Ø¨Ø§Ù‚ÙŠ " + (MAX_ATTEMPTS - t) + " Ù…Ø­Ø§ÙˆÙ„Ø§Øª";
        playBeep();
      }
    }

    window._d = function (t) {
      APP_DEVICE_ID = t;
      start();
    };

async function getRealDeviceId() {
    let id = "UNKNOWN";

    try {
        // Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙƒÙ„Ù… Ø§Ù„Ø¬Ø§ÙØ§ ÙÙŠ Ø§Ù„Ù€ MainActivity Ø¹Ù†Ø¯Ùƒ
        if (window.AndroidHost && window.AndroidHost.getAndroidId) {
            id = window.AndroidHost.getAndroidId();
        }
    } catch (e) {
        console.error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ø§ÙØ§:", e);
    }

    // Ù„Ùˆ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ÙØªÙˆØ­ ÙÙŠ Ù…ØªØµÙØ­ Ù…Ø´ APK
    if (id === "UNKNOWN" || !id) {
        let savedId = secureGet("unique_device_id");
        if (savedId) {
            id = savedId;
        } else {
            id = "WEB-" + btoa(navigator.userAgent).substring(10, 25).toUpperCase();
            secureSet("unique_device_id", id);
        }
    }

    return id;
}


    var totalArea = 0, calculations = [], globalWakeLock = null, currentTooltip = null, currentDisplayedPrice = 0;var selectedNotes = new Set();

    function showCustomAlert(t, e = "success", n = "") {
      const o = document.getElementById("customAlert"),
        a = document.getElementById("alertIcon"),
        l = document.getElementById("alertTitle"),
        i = document.getElementById("alertMessage"),
        c = document.getElementById("alertButtons");
      "success" === e ? (a.textContent = "âœ“", a.className = "alert-icon success", l.textContent = n || "Ù†Ø¬Ø­") :
        "error" === e ? (a.textContent = "âœ•", a.className = "alert-icon error", l.textContent = n || "ØªÙ†Ø¨ÙŠÙ‡") :
          "warning" === e && (a.textContent = "!", a.className = "alert-icon warning", l.textContent = n || "ØªØ­Ø°ÙŠØ±");
      i.textContent = t;
      c.innerHTML = '<button class="alert-ok-btn" onclick="closeCustomAlert()">Ø­Ø³Ù†Ø§Ù‹</button>';
      o.classList.add("show");
    }

    function closeCustomAlert() {
      document.getElementById("customAlert").classList.remove("show");
    }

    function customConfirm(t, e) {
      const n = document.getElementById("customAlert"),
        o = document.getElementById("alertIcon"),
        a = document.getElementById("alertTitle"),
        l = document.getElementById("alertMessage"),
        i = document.getElementById("alertButtons");
      o.textContent = "?";
      o.className = "alert-icon warning";
      a.textContent = "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ";
      l.textContent = t;
      i.innerHTML = '<button class="alert-ok-btn" onclick="handleConfirmYes()">Ù†Ø¹Ù…</button><button class="alert-cancel-btn" onclick="handleConfirmNo()">Ø¥Ù„ØºØ§Ø¡</button>';
      window.confirmCallback = e;
      n.classList.add("show");
    }

    function handleConfirmYes() {
      if (window.confirmCallback) {
        const t = window.confirmCallback;
        window.confirmCallback = null;
        closeCustomAlert();
        setTimeout(() => { t(true); }, 300);
      }
    }

    function handleConfirmNo() {
      window.confirmCallback && (window.confirmCallback = null);
      closeCustomAlert();
    }

    async function enableWakeLock() {  try {
        "wakeLock" in navigator && !globalWakeLock && (globalWakeLock = await navigator.wakeLock.request("screen"));
      } catch (t) { }
    }

    function toggleNoteSelection(noteId, event) {
      if (event) event.stopPropagation();
      playBeep();
      const noteElement = document.querySelector(`[data-note-id="${noteId}"]`);
      if (!noteElement) return;

      if (selectedNotes.has(noteId)) {
        selectedNotes.delete(noteId);
        noteElement.classList.remove('selected');
      } else {
        selectedNotes.add(noteId);
        noteElement.classList.add('selected');
      }

      const actionsBar = document.getElementById('notesActions');
      if (selectedNotes.size > 0) {
        actionsBar.classList.add('show');
      } else {
        actionsBar.classList.remove('show');
      }
    }

    function deleteSelected() {
      if (selectedNotes.size === 0) {
        showCustomAlert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…Ø°ÙƒØ±Ø§Øª", "warning");
        return;
      }

      playBeep();

      const notesToDelete = Array.from(selectedNotes);
      const count = notesToDelete.length;

      customConfirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ${count} Ù…Ø°ÙƒØ±Ø©ØŸ`, confirmed => {
        if (confirmed) {
          try {
            const saved = secureGet("marbleNotes");
            if (saved) {
              let notes = JSON.parse(saved);
              notes = notes.filter(note => !notesToDelete.includes(note.id));
              secureSet("marbleNotes", JSON.stringify(notes));
              selectedNotes.clear();
              document.getElementById('notesActions').classList.remove('show');
              loadSavedNotes();
              showCustomAlert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©", "success");        }
          } catch (err) {
            showCustomAlert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù", "error");
          }
        }
      });
    }

    function copySelected() {
      if (selectedNotes.size === 0) {
        showCustomAlert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù…Ø°ÙƒØ±Ø§Øª", "warning");
        return;
      }

      playBeep();
      try {
        const saved = secureGet("marbleNotes");
        if (saved) {
          const notes = JSON.parse(saved);
          const selectedNotesData = notes.filter(note => selectedNotes.has(note.id));

          let copyText = `ğŸ“‹ Ù…Ø°ÙƒØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© (${selectedNotesData.length})\n`;
          copyText += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

          selectedNotesData.forEach((note, index) => {
            copyText += `${index + 1}. ğŸ“‹ ${note.name}\n`;
            copyText += `ğŸ“… ${new Date(note.date).toLocaleDateString("ar-EG", { year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit" })}\n\n`;
            copyText += "ğŸ“ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:\n";
            note.calculations.forEach((calc, i) => {
              const pricePerMeter = calc.area > 0 ? (calc.price / calc.area).toFixed(2) : 0;
              copyText += `  ${i + 1}. Ø§Ù„Ø·ÙˆÙ„: ${calc.length}Ø³Ù… | Ø§Ù„Ø¹Ø±Ø¶: ${calc.width}Ø³Ù… | Ø§Ù„Ø¹Ø¯Ø¯: ${calc.count} | Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${calc.area.toFixed(2)} Ù…Â² | Ø§Ù„Ø³Ø¹Ø±: ${calc.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡ (Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: ${pricePerMeter})\n`;
            });
            copyText += `ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${note.totalArea.toFixed(2)} Ù…Â²\n`;
            copyText += `ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${note.totalPrice.toFixed(2)} Ø¬Ù†ÙŠÙ‡\n`;
            copyText += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";
          });

          navigator.clipboard.writeText(copyText).then(() => {
            showCustomAlert(`ØªÙ… Ù†Ø³Ø® ${selectedNotesData.length} Ù…Ø°ÙƒØ±Ø© Ù„Ù„Ø­Ø§ÙØ¸Ø©!`, "success");
            selectedNotes.clear();
            document.getElementById('notesActions').classList.remove('show');
            loadSavedNotes();
          }).catch(() => {
            showCustomAlert("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®", "error");
          });
        }
      } catch (err) { showCustomAlert("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®", "error"); }
    }

    function searchNotes() {  const searchTerm = document.getElementById("searchInput").value.toLowerCase().trim();
      if (!searchTerm) {
        displaySavedNotes(allNotes);
        return;
      }

      const filtered = allNotes.filter(note => {
        const nameMatch = note.name.toLowerCase().includes(searchTerm);
        const dateMatch = new Date(note.date).toLocaleDateString("ar-EG").includes(searchTerm);
        const priceMatch = note.totalPrice.toString().includes(searchTerm);
        const areaMatch = note.totalArea.toString().includes(searchTerm);

        return nameMatch || dateMatch || priceMatch || areaMatch;
      });

      displaySavedNotes(filtered);
    }

    function loadSavedNotes() {
      try {
        const t = secureGet("marbleNotes");
        if (t) {
          allNotes = JSON.parse(t).sort((t, e) => new Date(e.date) - new Date(t.date));
          const searchTerm = document.getElementById("searchInput").value.toLowerCase().trim();
          if (searchTerm) {
            searchNotes();
          } else {
            displaySavedNotes(allNotes);
          }
        } else {
          allNotes = [];
          document.getElementById("savedNotesList").innerHTML = '<div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>';
        }
      } catch (t) {
        allNotes = [];
        document.getElementById("savedNotesList").innerHTML = '<div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>';
      }
    }

    function displaySavedNotes(t) {
      const e = document.getElementById("savedNotesList");
      if (0 === t.length) {
        e.innerHTML = '<div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
        return;
      }
      e.innerHTML = t.map(t => {
        const isSelected = selectedNotes.has(t.id);
        return `<div class="saved-note-item ${isSelected ? 'selected' : ''}" data-note-id="${t.id}" onclick="toggleNoteSelection('${t.id}', event)">
          <div class="note-item-header">
            <div>          <div class="note-item-name">${t.name}</div>
              <div class="note-item-date">${new Date(t.date).toLocaleDateString("ar-EG", { year: "numeric", month: "short", day: "numeric", hour: "2-digit", minute: "2-digit" })}</div>
            </div>
            <div class="note-buttons">
              <button class="copy-note-btn" onclick="event.stopPropagation();copyNote('${t.id}')">ğŸ“‹</button>
              <button class="delete-note-btn" onclick="event.stopPropagation();deleteNote('${t.id}')">ğŸ—‘ï¸</button>
            </div>
          </div>
          <div class="note-item-details">
            <p style="font-weight:700;color:#8B0000;margin-bottom:10px;font-size:1em;">ğŸ“ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</p>
            <div style="overflow-x:auto;">
              <table class="operations-table">
                <thead>
                  <tr>
                    <th>Ø§Ù„Ø·ÙˆÙ„</th>
                    <th>Ø§Ù„Ø¹Ø±Ø¶</th>
                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                    <th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                  </tr>
                </thead>
                <tbody>
                  ${t.calculations.map((e, n) => {
          const o = e.area > 0 ? (e.price / e.area).toFixed(2) : 0;
          return `<tr>
            <td>${e.length} Ø³Ù…</td>
            <td>${e.width} Ø³Ù…</td>
            <td>${e.count}</td>
            <td><strong>${e.area.toFixed(2)}</strong></td>
            <td class="price-cell" onclick="event.stopPropagation();showPriceTooltip(event,${o},'note-${t.id}')">
              <strong>${e.price.toFixed(2)}</strong>
            </td>
          </tr>`;
        }).join("")}
                </tbody>
              </table>
            </div>
            <p style="margin-top:10px;font-weight:700;font-size:1.05em;">
              ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:
              <span style="color:#8B0000;font-size:1.2em;">${t.totalArea.toFixed(2)} Ù…Â²</span>
            </p>
            <p class="note-price-per-meter" id="note-price-${t.id}">
              ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: ${t.pricePerMeter.toFixed(2)} Ø¬Ù†ÙŠÙ‡
            </p>
            <p class="note-item-total">ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t.totalPrice.toFixed(2)} Ø¬Ù†ÙŠÙ‡</p>
          </div>
        </div>`;
      }).join("");
    }
    function deleteNote(t) {
      playBeep();
      customConfirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø°ÙƒØ±Ø©ØŸ", e => {
        if (e) {
          try {
            const e = secureGet("marbleNotes");
            if (e) {
              let n = JSON.parse(e);
              n = n.filter(e => e.id !== t);
              secureSet("marbleNotes", JSON.stringify(n));
              selectedNotes.delete(t);
              if (selectedNotes.size === 0) {
                document.getElementById('notesActions').classList.remove('show');
              }
              loadSavedNotes();
              showCustomAlert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­", "success");
            }
          } catch (t) {
            showCustomAlert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù", "error");
          }
        }
      });
    }

    function copyNote(t) {
      playBeep();
      try {
        const e = secureGet("marbleNotes");
        if (e) {
          const n = JSON.parse(e).find(e => e.id === t);
          if (n) {
            let t = `ğŸ“‹ ${n.name}\n`;
            t += `ğŸ“… ${new Date(n.date).toLocaleDateString("ar-EG", { year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit" })}\n\n`;
            t += "ğŸ“ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:\n";
            t += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
            n.calculations.forEach((e, n) => {
              const o = e.area > 0 ? (e.price / e.area).toFixed(2) : 0;
              t += `${n + 1}. Ø§Ù„Ø·ÙˆÙ„: ${e.length}Ø³Ù… | Ø§Ù„Ø¹Ø±Ø¶: ${e.width}Ø³Ù… | Ø§Ù„Ø¹Ø¯Ø¯: ${e.count} | Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${e.area.toFixed(2)} Ù…Â² | Ø§Ù„Ø³Ø¹Ø±: ${e.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡ (Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: ${o})\n`;
            });
            t += "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
            t += `ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${n.totalArea.toFixed(2)} Ù…Â²\n`;
            t += `ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${n.totalPrice.toFixed(2)} Ø¬Ù†ÙŠÙ‡\n`;
            navigator.clipboard.writeText(t).then(() => {
              showCustomAlert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ù„Ù„Ø­Ø§ÙØ¸Ø©!", "success");
            }).catch(() => {
              showCustomAlert("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®", "error");
            });
          }
        }
      } catch (t) {    showCustomAlert("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®", "error");
      }
    }

    function toggleNotes() {
      playBeep();
      const t = document.getElementById("notesPanel");
      t.classList.toggle("open");
      if (t.classList.contains("open")) {
        loadSavedNotes();
      } else {
        selectedNotes.clear();
        document.getElementById('notesActions').classList.remove('show');
        document.getElementById('searchInput').value = '';
      }
    }

    function handleCountSelect(t) {
      playBeep();
      const e = document.getElementById("customCount");
      "custom" === t.value ? (e.style.display = "block", e.focus()) : e.style.display = "none";
    }

    function calculate() {
      playBeep();
      const lengthCm = parseFloat(document.getElementById("length").value) || 0;
      const widthCm = parseFloat(document.getElementById("width").value) || 0;
      const countSelect = document.getElementById("countSelect").value;
      const customCount = parseFloat(document.getElementById("customCount").value) || 0;
      const pricePerMeter = parseFloat(document.getElementById("pricePerMeter").value) || 0;

      let count = 0;
      if (countSelect === "custom") {
        count = customCount;
      } else {
        count = parseFloat(countSelect) || 0;
      }

      const lengthM = lengthCm / 100;
      const widthM = widthCm / 100;

      if (lengthM > 0 && widthM > 0 && count > 0 && pricePerMeter > 0) {
        const area = lengthM * widthM * count;
        const totalPrice = area * pricePerMeter;
        totalArea += area;
        calculations.push({
          length: lengthCm,
          width: widthCm,
          count: count,
          area: area,      price: totalPrice,
          pricePerMeter: pricePerMeter
        });

        document.getElementById("totalArea").innerHTML = totalArea.toFixed(2) + ' <span class="unit">Ù…Â²</span>';
        updateTotalPrice();

        document.getElementById("length").value = "";
        document.getElementById("width").value = "";
        document.getElementById("countSelect").value = "1";
        document.getElementById("customCount").value = "";
        document.getElementById("customCount").style.display = "none";
        document.getElementById("length").focus();

        document.getElementById("totalPriceBox").scrollIntoView({ behavior: "smooth", block: "start" });

      } else {
        showCustomAlert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­", "warning");
      }
    }

    function updateTotalPrice() {
      const t = document.getElementById("totalPriceBox");
      let e = 0;
      calculations.forEach(t => { e += t.price });
      e > 0 ? (document.getElementById("totalPrice").innerHTML = e.toFixed(2) + ' <span class="unit">Ø¬Ù†ÙŠÙ‡</span>', t.style.display = "block") : t.style.display = "none";
    }

    function resetAll() {
      playBeep();
      customConfirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§ØªØŸ", t => {
        t && (totalArea = 0,
          calculations = [],
          document.getElementById("totalArea").innerHTML = '0.00 <span class="unit">Ù…Â²</span>',
          document.getElementById("length").value = "",
          document.getElementById("width").value = "",
          document.getElementById("countSelect").value = "1",
          document.getElementById("customCount").value = "",
          document.getElementById("customCount").style.display = "none",
          document.getElementById("totalPriceBox").style.display = "none",
          document.getElementById("noteName").value = "",
          showCustomAlert("ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "success"));
      });
    }

    function saveNote() {
      playBeep();
      const t = document.getElementById("noteName").value.trim();
      if (!t)
        return void showCustomAlert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø©", "warning");  if (0 === calculations.length)
        return void showCustomAlert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø³Ø§Ø¨ÙŠØ© Ù„Ø­ÙØ¸Ù‡Ø§", "warning");
      let e = 0;
      calculations.forEach(t => { e += t.price });
      const n = 0; // â† always zero
      try {
        const o = {
          id: Date.now().toString(),
          name: t,
          calculations: [...calculations],
          totalArea: totalArea,
          totalPrice: e,
          pricePerMeter: n,
          date: (new Date()).toISOString()
        };
        let a = secureGet("marbleNotes");
        let l = [];
        if (a) {
          try {
            l = JSON.parse(a);
            if (!Array.isArray(l)) l = [];
          } catch (err) {
            l = [];
          }
        }
        l.push(o);
        secureSet("marbleNotes", JSON.stringify(l));
        showCustomAlert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!", "success");
        document.getElementById("noteName").value = "";
        loadSavedNotes();
      } catch (err) {
        console.error("Ø®Ø·Ø£ Ø§Ù„Ø­ÙØ¸:", err);
        showCustomAlert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "error");
      }
    }

    function showPriceTooltip(t, e, n) {
      playBeep();

      if (currentTooltip) {
        document.body.removeChild(currentTooltip);
        currentTooltip = null;
      }

      currentDisplayedPrice = parseFloat(e);

      if (n) {
        const noteId = n.split("-")[1];
        const priceElement = document.getElementById("note-price-" + noteId);
        if (priceElement) {      priceElement.innerHTML = `ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: ${e} Ø¬Ù†ÙŠÙ‡`;
        }
      }
      const o = document.createElement("div");
      o.className = "price-tooltip show";
      o.textContent = `Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: ${e} Ø¬Ù†ÙŠÙ‡`;
      document.body.appendChild(o);

      const a = t.target.getBoundingClientRect();
      const tooltipLeft = a.left + a.width / 2 - o.offsetWidth / 2;
      const tooltipTop = a.top - o.offsetHeight - 15;

      o.style.left = Math.max(10, Math.min(tooltipLeft, window.innerWidth - o.offsetWidth - 10)) + "px";
      o.style.top = Math.max(10, tooltipTop) + "px";

      currentTooltip = o;

      setTimeout(() => {
        o.classList.remove("show");
        setTimeout(() => {
          if (currentTooltip === o) {
            document.body.removeChild(o);
            currentTooltip = null;
          }
        }, 300);
      }, 3000);
    }

    document.getElementById("length").addEventListener("keypress", function (t) {
      "Enter" === t.key && calculate();
    });

    document.getElementById("width").addEventListener("keypress", function (t) {
      "Enter" === t.key && calculate();
    });

    document.getElementById("customCount").addEventListener("keypress", function (t) {
      "Enter" === t.key && calculate();
    });

    document.addEventListener("click", function (t) {
      const panel = document.getElementById("notesPanel");
      const burger = document.querySelector(".burger-icon");

      if (
        panel.classList.contains("open") &&
        !panel.contains(t.target) &&
        !burger.contains(t.target)
      ) {
        panel.classList.remove("open");    selectedNotes.clear();
        document.getElementById('notesActions').classList.remove('show');
      }
    }, true);

    document.addEventListener("selectstart", t => {
      "INPUT" !== t.target.tagName && "TEXTAREA" !== t.target.tagName && t.preventDefault();
    });

    document.addEventListener("visibilitychange", async () => {
      !document.hidden && !globalWakeLock && await enableWakeLock();
    });

    window.addEventListener("load", () => {
      enableWakeLock();
      loadSavedNotes();
      loadPrice();
      addInputSounds(); // â† Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØª Ù„ÙƒÙ„ Ø¥Ù†Ø¨ÙˆØª

      // Ù„Ù„Ù€ APK ÙÙ‚Ø·
      getRealDeviceId().then(deviceId => {
        _d(deviceId);
      });
    });
</script>
</body>
</html>